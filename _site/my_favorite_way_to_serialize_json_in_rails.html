<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>My Favorite way to serialize JSON in Rails</title>
		<link rel="stylesheet" href="/assets/css/styles.css" />
		<script src="https://kit.fontawesome.com/7c7973c6b2.js"></script>
		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" /> <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>My Favorite way to serialize JSON in Rails</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="My Favorite way to serialize JSON in Rails" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Action Model Serializer" />
<meta property="og:description" content="Action Model Serializer" />
<link rel="canonical" href="http://localhost:4000/my_favorite_way_to_serialize_json_in_rails" />
<meta property="og:url" content="http://localhost:4000/my_favorite_way_to_serialize_json_in_rails" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-09-16T17:11:19+02:00" />
<script type="application/ld+json">
{"description":"Action Model Serializer","@type":"BlogPosting","url":"http://localhost:4000/my_favorite_way_to_serialize_json_in_rails","headline":"My Favorite way to serialize JSON in Rails","dateModified":"2018-09-16T17:11:19+02:00","datePublished":"2018-09-16T17:11:19+02:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/my_favorite_way_to_serialize_json_in_rails"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

	</head>
	<body>
		<h1>My Favorite way to serialize JSON in Rails</h1>

<p>
	16 Sep 2018  
</p>

<h2 id="action-model-serializer">Action Model Serializer</h2>

<p>There are a few ways to do this: to_json, fast_jsonapi is a new one, but my favorite is action_model_serializer. Why? Well, i spent many hours banging my head against other ways, using to_json, pouring over the documentation, following examples exactly and still couldnt get it, even resorted to manually serailizing. Then I found it, the one, active_model_serializer. Want to easily attach nested associations? Want to use one serializer for single models and associations? Want to pass in the exact same html from your show view? Here is how it works.</p>

<p>first, install the gem:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gem 'active_model_serializers', '~&gt; 0.10.2'
bundle install
</code></pre></div></div>

<p>Next generate a serailizer based on an existing model:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails g serializer Product
</code></pre></div></div>

<p>this creates this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;!-- app/serializers/post_serializer.rb --&gt;
class ProductSerializer &lt; ActiveModel::Serializer
  attributes :id
end

</code></pre></div></div>
<p>Now you can add other attributes and associations:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ProductSerializer &lt; ActiveModel::Serializer
  attributes :id, :name, :price, :category
  belongs_to :brand
end
</code></pre></div></div>
<p>For the association to work you must add another serializer for brand:</p>

<p>EDIT: Actually, you don’t need the second serializer for it to work, but this will allow you to customize the association sent, trimming back attributes that aren’t needed, custom methods, etc….</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rails g serializer Brand
</code></pre></div></div>
<p>and in that serializer:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class BrandSerializer &lt; ActiveModel::Serializer
 attributes: :id, :name, :motto
 has_many :products
end
</code></pre></div></div>

<p>Add a nested association, but again must add a serializer for users and reviews:</p>

<p>EDIT: again not needed, but recommended.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ProductSerializer &lt; ActiveModel::Serializer
  attributes :id, :name, :price, :category
  belongs_to :brand
  has_many :reviews
  has_many :users, through: :reviews
end
</code></pre></div></div>

<p>Now, all of that will be sent via serailized JSONt. Cool right? But… we’re not finished yet, in your controller:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def show
	@product = Product.find(params[:id])
	render json: @product, serializer: ProductSerializer
end
</code></pre></div></div>
<p>That’s it, send an api call to ‘/products/:id’ and you’ll get all the product data, the brand, the reviews, and users. Now, to show an index of all products, with all this data available for each one:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def index
		@products = Product.all
		render json: @products, each_serailzer: ProductSerializer
	end
</code></pre></div></div>

<p>All products sent will have all the same data.</p>

<p>You can also send the entire show view:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ProductSerializer &lt; ActiveModel::Serializer
  attributes :id, :name, :price, :category

  attributes :show

  belongs_to :brand
  has_many :reviews
  has_many :users, through: :reviews

  def show
  	ProductsController.render(:show, assigns: {product: object}, layout: false)
  end
end
</code></pre></div></div>

<p>This is rendering the view associated with the ProductsController action. this line:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>assigns: {product: object}
</code></pre></div></div>
<p>is setting the product instance variable as the object that the serializer is called upon. Basically, in the serializer, object represents self.</p>

<p>You can also customize these methods any way you want:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class ProductSerializer &lt; ActiveModel::Serializer
  attributes :id, :name, :price, :category

  attributes :show
  attributes :all_current_orders

  belongs_to :brand
  has_many :reviews
  has_many :users, through: :reviews

  def show
  	ProductsController.render(:show, assigns: {product: object}, layout: false)
  end

  def all_current_orders
  	object.orders.select {|order| order.created_at &gt;= Time.now - 5.days }
  end
end
</code></pre></div></div>

<h2 id="in-conclusion">In Conclusion</h2>

<p>I struggled for a while with to_json, which is still good and fast for simple direct associations OR methods. I never got it to work correctly with associations AND methods. It just didn’t seem as flexible, and it says on the rails API dock it may be depricated. Although, as of this writing, the active_record_serializers gem is still being developed, it’s working swimmingly so far. Thumbs up!</p>


		<script
			src="https://code.jquery.com/jquery-3.4.1.js"
			integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
			crossorigin="anonymous"
		></script>
		<script src="assets/js/index.js"></script>
	</body>
</html>
